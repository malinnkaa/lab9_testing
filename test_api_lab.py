import requests
import pytest

# –ë–∞–∑–æ–≤—ã–π URL API (–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π, –±–µ–∑ IP-–∞–¥—Ä–µ—Å–æ–≤!)
BASE_URL = "https://jsonplaceholder.typicode.com"

print("=== –ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ REST API ===\n")

# –¢–ï–°–¢ 1: GET-–∑–∞–ø—Ä–æ—Å (–ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
def test_get_user():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å id=1."""
    print("1. GET /users/1 - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º GET-–∑–∞–ø—Ä–æ—Å
    response = requests.get(f"{BASE_URL}/users/1")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –°—Ç–∞—Ç—É—Å –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200 OK
    assert response.status_code == 200, f"–û—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code}"
    print(f"   ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code} (–æ–∂–∏–¥–∞–ª–æ—Å—å: 200)")
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–≤–µ—Ç –≤ JSON
    user_data = response.json()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    required_fields = ['id', 'name', 'username', 'email', 'address', 'phone', 'website', 'company']
    for field in required_fields:
        assert field in user_data, f"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–µ: {field}"
    print(f"   ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON: –≤—Å–µ {len(required_fields)} –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ó–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª–µ–π
    assert user_data['id'] == 1, f"ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 1, –ø–æ–ª—É—á–µ–Ω: {user_data['id']}"
    assert '@' in user_data['email'], f"Email –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @: {user_data['email']}"
    assert user_data['address']['city'] is not None, "–ì–æ—Ä–æ–¥ –≤ –∞–¥—Ä–µ—Å–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–∫–∞–∑–∞–Ω"
    
    print(f"   ‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π: ID={user_data['id']}, Email={user_data['email']}")
    print("   ‚úÖ GET-—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n")
    return True

# –¢–ï–°–¢ 2: POST-–∑–∞–ø—Ä–æ—Å (—Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
def test_create_user():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    print("2. POST /users - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")
    
    # –î–∞–Ω–Ω—ã–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    new_user = {
        "name": "Ivan Ivanov",
        "username": "ivan_i",
        "email": "ivan@example.com",
        "phone": "123-456-7890"
    }
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º POST-–∑–∞–ø—Ä–æ—Å
    response = requests.post(f"{BASE_URL}/users", json=new_user)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –°—Ç–∞—Ç—É—Å –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 201 Created
    assert response.status_code == 201, f"–û—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code}"
    print(f"   ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code} (–æ–∂–∏–¥–∞–ª–æ—Å—å: 201)")
    
    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    created_user = response.json()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞–º–∏ –¥–∞–Ω–Ω—ã–µ
    assert created_user['name'] == new_user['name'], "–ò–º—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
    assert created_user['username'] == new_user['username'], "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
    assert created_user['email'] == new_user['email'], "Email –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –°–µ—Ä–≤–µ—Ä –ø—Ä–∏—Å–≤–æ–∏–ª ID (–ø—Ä–∏–∑–Ω–∞–∫ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è)
    assert 'id' in created_user, "–û—Ç–≤–µ—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç ID –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    assert isinstance(created_user['id'], int), f"ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º: {created_user['id']}"
    
    print(f"   ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –ø—Ä–∏—Å–≤–æ–µ–Ω ID: {created_user['id']}")
    print("   ‚úÖ POST-—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n")
    return True

# –¢–ï–°–¢ 3: PUT-–∑–∞–ø—Ä–æ—Å (–æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
def test_update_user():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    print("3. PUT /users/1 - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...")
    
    # –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    updated_data = {
        "name": "Updated Name",
        "username": "updated_user",
        "email": "updated@example.com",
        "phone": "987-654-3210"
    }
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PUT-–∑–∞–ø—Ä–æ—Å
    response = requests.put(f"{BASE_URL}/users/1", json=updated_data)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –°—Ç–∞—Ç—É—Å –∫–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200 OK
    assert response.status_code == 200, f"–û—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code}"
    print(f"   ‚úÖ –°—Ç–∞—Ç—É—Å –∫–æ–¥: {response.status_code} (–æ–∂–∏–¥–∞–ª–æ—Å—å: 200)")
    
    # –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    updated_user = response.json()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    assert updated_user['name'] == updated_data['name'], "–ò–º—è –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å"
    assert updated_user['username'] == updated_data['username'], "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –æ–±–Ω–æ–≤–∏–ª–æ—Å—å"
    assert updated_user['email'] == updated_data['email'], "Email –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: ID –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º
    assert updated_user['id'] == 1, f"ID –∏–∑–º–µ–Ω–∏–ª—Å—è: {updated_user['id']}"
    
    print(f"   ‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: –∏–º—è='{updated_user['name']}', email='{updated_user['email']}'")
    print("   ‚úÖ PUT-—Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n")
    return True

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
def run_all_tests():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ."""
    print("=" * 50)
    print("–ó–ê–ü–£–°–ö –ê–í–¢–û–ú–ê–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–• –¢–ï–°–¢–û–í API")
    print("=" * 50)
    
    try:
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç—Ä–∏ —Ç–µ—Å—Ç–∞
        test_get_user()
        test_create_user()
        test_update_user()
        
        # –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        print("=" * 50)
        print("üéâ –í–°–ï –¢–ï–°–¢–´ –£–°–ü–ï–®–ù–û –ü–†–û–ô–î–ï–ù–´!")
        print("=" * 50)
        return True
    except AssertionError as e:
        print(f"\n‚ùå –¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù: {e}")
        print("=" * 50)
        return False
    except Exception as e:
        print(f"\n‚ö†Ô∏è –ù–ï–ò–ó–í–ï–°–¢–ù–ê–Ø –û–®–ò–ë–ö–ê: {e}")
        print("=" * 50)
        return False

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ pytest (–¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
if __name__ == "__main__":
    # –ï—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
    success = run_all_tests()
    
    if success:
        print("\n‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∑–∞–ø—É—Å–∫—É —á–µ—Ä–µ–∑ pytest!")
        print("   –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: pytest lab5_final_tests.py -v")
    else:
        print("\n‚ö†Ô∏è –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–µ—Å—Ç–∞–º–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥.")